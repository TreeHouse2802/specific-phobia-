<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tháº£o luáº­n vá» Ãm Sá»£ ChuyÃªn Biá»‡t</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #f8bbd0, #f3e5f5);
      padding: 1rem;
      color: #4a148c;
    }
    .admin-banner {
      background: #fce4ec;
      padding: 12px;
      border-left: 6px solid #ce93d8;
      margin-bottom: 20px;
      border-radius: 8px;
      font-weight: bold;
    }
    h1 {
      text-align: center;
      color: #6a1b9a;
    }
    input, textarea {
      width: 100%;
      max-width: 600px;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 12px;
      border-radius: 6px;
      border: 1px solid #ce93d8;
      background-color: #ffffff;
      box-shadow: 2px 2px 4px rgba(0,0,0,0.05);
    }
    button {
      padding: 8px 14px;
      margin: 4px;
      border: none;
      background-color: #ba68c8;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background-color: #ab47bc;
    }
    .comment-section {
      margin-top: 2rem;
    }
    .comment {
      background-color: #ffffff;
      border-left: 5px solid #ba68c8;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 6px;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.05);
    }
    .reply {
      margin-left: 30px;
      border-left: 3px dashed #ce93d8;
      padding-left: 10px;
      margin-top: 8px;
    }
    .comment-footer button {
      background: #f3e5f5;
      color: #6a1b9a;
    }
    .comment-footer button:hover {
      background: #e1bee7;
    }
    .pinned {
      border-left: 5px solid #ffca28;
      background: #fff8e1;
    }
    .toggle-section {
      margin: 20px 0;
      padding: 10px;
      background: #fce4ec;
      border-radius: 8px;
    }
    .toggle-section h3 {
      cursor: pointer;
      color: #ad1457;
    }
    .toggle-content {
      display: none;
      margin-top: 10px;
    }
    .toggle-content img {
      max-width: 100%;
      border-radius: 6px;
    }
    .reference-links ul {
      padding-left: 20px;
    }
    .sort-options {
      margin-top: 1rem;
    }
    .sort-options label {
      font-weight: bold;
      color: #6a1b9a;
    }
    select {
      border-radius: 6px;
      padding: 6px;
      border: 1px solid #ce93d8;
    }
    .timestamp {
      font-size: 0.8em;
      color: #888;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="admin-banner">
    ğŸ“¢ Tin nháº¯n tá»« quáº£n trá»‹ viÃªn: Cáº£m Æ¡n báº¡n Ä‘Ã£ tham gia tháº£o luáº­n! HÃ£y Ä‘áº£m báº£o ngÃ´n tá»« phÃ¹ há»£p vÃ  chia sáº» chÃ¢n thÃ nh nhÃ©.
    <button onclick="promptAdmin()">ğŸ” ÄÄƒng nháº­p quáº£n trá»‹ viÃªn</button>
    <button onclick="logoutAdmin()" id="adminLogout" style="display:none">ğŸšª ÄÄƒng xuáº¥t</button>
  </div>

  <h1>Tháº£o luáº­n: Ãm Sá»£ ChuyÃªn Biá»‡t</h1>

  <div class="toggle-section">
    <h3 onclick="toggleContent('info')">ğŸ“Œ áº¨n/Hiá»‡n Infographic</h3>
    <div id="info" class="toggle-content">
      <img src="3444846f-c34f-4693-afe4-b770a69b419e.png" alt="Infographic 1">
      <img src="ec4dee0c-44eb-4549-a1c2-9619be8edc21.png" alt="Infographic 2">
    </div>
  </div>

  <div class="toggle-section">
    <h3 onclick="toggleContent('references')">ğŸ“– áº¨n/Hiá»‡n TÃ i liá»‡u tham kháº£o</h3>
    <div id="references" class="toggle-content reference-links">
      <ul>
        <li><a href="https://dictionary.apa.org/specific-phobia" target="_blank">KhÃ¡i niá»‡m</a></li>
        <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5674525/" target="_blank">BÃ i bÃ¡o nghiÃªn cá»©u</a></li>
        <li><a href="https://dn790004.ca.archive.org/0/items/APA-DSM-5/DSM5.pdf" target="_blank">Triá»‡u chá»©ng (trang 247/992)</a></li>
        <li><a href="#">Äiá»u trá»‹ (trang 48â€“49 â€“ sÃ¡ch Hiá»ƒu háº¿t vá» TÃ¢m lÃ½ há»c, Hemmings)</a></li>
      </ul>
    </div>
  </div>

  <input id="username" placeholder="TÃªn cá»§a báº¡n" />
  <label><input type="checkbox" id="anonymous" /> áº¨n danh</label>
  <textarea id="commentText" rows="4" placeholder="Nháº­p bÃ¬nh luáº­n cá»§a báº¡n..."></textarea>
  <button onclick="postComment()">ğŸ’¬ Gá»­i bÃ¬nh luáº­n</button>

  <div class="sort-options">
    <label for="sortSelect">Sáº¯p xáº¿p theo: </label>
    <select id="sortSelect" onchange="loadComments()">
      <option value="recent">Má»›i nháº¥t</option>
      <option value="emotion">LÆ°á»£t cáº£m xÃºc</option>
    </select>
  </div>

  <div class="comment-section">
    <h3>Táº¥t cáº£ bÃ¬nh luáº­n:</h3>
    <div id="comments"></div>
  </div>

  <script>
    const firebaseConfig = {
      databaseURL: "https://specific-phobia-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let isAdmin = false;
    const ADMIN_NAME = 'admin';
    const ADMIN_PASS = 'matkhau123';

    function toggleContent(id) {
      const content = document.getElementById(id);
      content.style.display = content.style.display === 'block' ? 'none' : 'block';
    }

    function formatTimestamp(ts) {
      const d = new Date(ts);
      return d.toLocaleString('vi-VN', {
        hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit', year: 'numeric'
      });
    }

    function getEmotionScore(c) {
      return (c.likes || 0) + (c.hearts || 0) + (c.laughs || 0);
    }

    function loadComments() {
      db.ref('comments').on('value', snapshot => {
        renderComments(snapshot);
      });
    }

    function renderComments(snapshot) {
      const container = document.getElementById('comments');
      const data = snapshot.val() || {};
      const comments = Object.entries(data).map(([id, c]) => ({ ...c, id }));
      const sortMode = document.getElementById('sortSelect')?.value || 'recent';
      const sorted = comments.sort((a, b) => {
        if ((b.pinned || 0) - (a.pinned || 0) !== 0) return (b.pinned || 0) - (a.pinned || 0);
        if (sortMode === 'emotion') return getEmotionScore(b) - getEmotionScore(a);
        return b.timestamp - a.timestamp;
      });

      container.innerHTML = '';
      for (const comment of sorted) {
        const div = document.createElement('div');
        div.className = 'comment';
        if (comment.pinned) div.classList.add('pinned');
        div.innerHTML = `
          <strong>${comment.name}</strong><br>${comment.text}<br>
          <div class="timestamp">ğŸ•’ ${formatTimestamp(comment.timestamp)}</div>
          <div class="comment-footer">
            <button onclick="likeComment('${comment.id}')">ğŸ‘ ${comment.likes || 0}</button>
            <button onclick="emojiComment('${comment.id}', 'â¤ï¸')">â¤ï¸ ${comment.hearts || 0}</button>
            <button onclick="emojiComment('${comment.id}', 'ğŸ˜‚')">ğŸ˜‚ ${comment.laughs || 0}</button>
            ${isAdmin ? `<button onclick="pinComment('${comment.id}')">ğŸ“Œ Ghim</button>
            <button onclick="deleteComment('${comment.id}')">âŒ XÃ³a</button>` : ''}
          </div>
        `;
        container.appendChild(div);
      }
    }

    function postComment() {
      const name = document.getElementById('anonymous').checked ? 'áº¨n danh' : (document.getElementById('username').value.trim() || 'KhÃ´ng tÃªn');
      const text = document.getElementById('commentText').value.trim();
      if (!text) return alert('Vui lÃ²ng nháº­p ná»™i dung bÃ¬nh luáº­n.');
      const newRef = db.ref('comments').push();
      newRef.set({ name, text, timestamp: Date.now() });
      document.getElementById('commentText').value = '';
    }

    function likeComment(id) {
      const ref = db.ref(`comments/${id}/likes`);
      ref.transaction(val => (val || 0) + 1);
    }

    function emojiComment(id, type) {
      const field = type === 'â¤ï¸' ? 'hearts' : 'laughs';
      const ref = db.ref(`comments/${id}/${field}`);
      ref.transaction(val => (val || 0) + 1);
    }

    function pinComment(id) {
      const ref = db.ref(`comments/${id}/pinned`);
      ref.transaction(val => !val);
    }

    function deleteComment(id) {
      db.ref(`comments/${id}`).remove();
    }

    function promptAdmin() {
      const name = prompt('TÃªn Ä‘Äƒng nháº­p:');
      const pass = prompt('Máº­t kháº©u:');
      if (name === ADMIN_NAME && pass === ADMIN_PASS) {
        isAdmin = true;
        document.getElementById('adminLogout').style.display = 'inline-block';
        alert('ÄÄƒng nháº­p quáº£n trá»‹ thÃ nh cÃ´ng');
        loadComments();
      } else {
        alert('Sai thÃ´ng tin');
      }
    }

    function logoutAdmin() {
      isAdmin = false;
      document.getElementById('adminLogout').style.display = 'none';
      alert('ÄÃ£ Ä‘Äƒng xuáº¥t quáº£n trá»‹');
      loadComments();
    }

    loadComments();
  </script>
</body>
</html>
